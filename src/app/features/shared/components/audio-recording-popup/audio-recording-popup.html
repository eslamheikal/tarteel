@if (isOpen) {
<div class="popup-overlay" (click)="onCancel()">
  <div class="popup-content" (click)="$event.stopPropagation()">
    <div class="popup-header">
      <h3>{{ editingRecording ? 'تعديل التسجيل' : 'إضافة تسجيل جديد' }}</h3>
      <button type="button" (click)="onCancel()" class="close-button">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="popup-body">
      <form [formGroup]="recordingForm" class="recording-form">
        <div class="form-row">
          <div class="form-group">
            <label for="title">عنوان التسجيل *</label>
            <input type="text" id="title" formControlName="title"
              placeholder="مثال: سورة الأعراف" [class.error]="isFieldInvalid('title')"
              class="form-input background-blur">
            @if (isFieldInvalid('title')) {
            <span class="text-danger">{{ getFieldError('title') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="duration">المدة *</label>
            <input type="text" id="duration" formControlName="duration"
              placeholder="مثال: 04:12" [class.error]="isFieldInvalid('duration')" 
              class="form-input background-blur">
            @if (isFieldInvalid('duration')) {
            <span class="text-danger">{{ getFieldError('duration') }}</span>
            }
            <small class="form-hint">تنسيق: دقائق:ثواني (مثال: 04:12)</small>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="audioUrl">رابط التسجيل الصوتي *</label>
            <input type="url" id="audioUrl" formControlName="audioUrl"
              placeholder="https://example.com/audio.mp3" [class.error]="isFieldInvalid('audioUrl')"
              class="form-input background-blur">
            @if (isFieldInvalid('audioUrl')) {
            <span class="text-danger">{{ getFieldError('audioUrl') }}</span>
            }
          </div>

          <div class="form-group">
            <label for="recitationType">نوع التلاوة *</label>
            <select id="recitationType" formControlName="recitationType"
              [class.error]="isFieldInvalid('recitationType')" class="form-select background-blur">
              @for (type of recitationTypes; track type.value) {
              <option [value]="type.value">{{ type.label }}</option>
              }
            </select>
            @if (isFieldInvalid('recitationType')) {
            <span class="text-danger">{{ getFieldError('recitationType') }}</span>
            }
          </div>
        </div>
      </form>
    </div>

    <div class="popup-footer">
      <button type="button" (click)="onCancel()" class="btn btn-secondary">
        إلغاء
      </button>
      <button type="button" (click)="onSave()" [disabled]="recordingForm.invalid" class="btn btn-primary">
        {{ editingRecording ? 'تحديث' : 'حفظ' }}
      </button>
    </div>
  </div>
</div>
}
